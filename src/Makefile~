# $Id: Makefile,v 1.1.1.1 2009/12/09 14:29:22 sjetschny Exp $ 
# Makefile for fdmpi

#--------------------------------------------------------
# edit here:

# source code for model generation (acoustic)

MODEL_SCR_A = hh_acoustic.c

# source code for model generation (elastic)

#MODEL_SCR = hh_bench2.c
#MODEL_SCR = hh_3DSchach.c
#MODEL_SCR = hh_FLnodes.c
#MODEL_SCR = hh_CPML.c
#MODEL_SCR = tuebbing.c
# reading input data from ASCII-file:
# MODEL_SCR = readmod.c
#MODEL_SCR = hh_toy.c
MODEL_SCR = hh_reflect.c

# Compiler (LAM: CC=hcc, CRAY T3E: CC=cc, SHARCNet: mpicc)

# ON Linux cluster running LAM
CC=hcc
LFLAGS=-lm -lmpi -lcseife
CFLAGS=-Wall -O4
SFLAGS=-L./../libcseife 
IFLAGS=-I./../libcseife

#Hermit
#CC=cc
#LFLAGS=-lm -lcseife
#CFLAGS=-O3
#SFLAGS=-L./../libcseife 
#IFLAGS=-I./../libcseife

#CFLAGS=-Wall -g -g3 -ggdb
# -O4

# On CRAY T3E
#CC=cc

# Juropa
#CC=mpicc
#LFLAGS=-lm
#CFLAGS=-Wall -O4 -ipo

# On HLRN system
#CC=mpcc
#LFLAGS=-lm  

# ON Linux cluster ALTIX.RZ.UNI-KIEL:DE
#CC=icc
#CFLAGS=-mp -O3 -ip0q
#LFLAGS=-lmpi -lm

# ON Linux cluster ALTIX.HRZ.TU-FREIBERG.DE
#CC=icc
#CFLAGS=-mp -O3 -ip0
#LFLAGS=-lmpi -lm -i-static


# after this line, no further editing should be necessary
# --------------------------------------------------------

.c.o:
	$(CC) -c  $(CFLAGS) $< $(IFLAGS)


SEISMERGE_SCR = seismerge.c


SNAPMERGE_SCR = \
	snapmerge.c \
	merge.c \
	read_par.c \
	readdsk.c \
	writedsk.c \
	util.c 
	
PARTMODEL_SCR = \
	part_model.c \
	read_par.c \
	util.c 	


FDMPI_UTIL = \
		absorb.c \
		av_mat.c \
		comm_ini.c \
		info.c \
		initproc.c \
		initproc_block.c \
		initsour.c \
		merge.c \
		mergemod.c \
		note.c \
		outseis.c \
		output_source_signal.c \
		PML_ini.c \
		rd_sour.c \
		read_checkpoint.c\
		readdsk.c \
		read_par.c \
		exchange_par.c \
		receiver.c \
		save_checkpoint.c\
		saveseis.c \
		sources.c \
		splitrec.c \
		splitsrc.c \
		timing.c \
		util.c \
		wavelet.c \
		writedsk.c \
		writemod.c \
		writepar.c \
		zero.c \
		zero_fdmpi.c \
		rwsegy.c \

FDMPI_SRC = \
		fdmpi.c \
		comm_ini_s.c \
		checkfd_ssg.c \
		CPML_coeff.c \
		CPML_ini_elastic.c\
		seismo_ssg.c \
		matcopy.c \
		surface_ssg.c \
		surface_ssg_elastic.c\
		update_s_ssg.c \
		update_s_ssg_CPML.c \
		update_s_ssg_elastic.c \
		update_s_ssg_CPML_elastic.c \
		update_v_ssg.c \
		update_v_ssg_CPML.c \
		snap_ssg.c \
		exchange_v.c \
		exchange_s.c \
		psource.c \
		readseis.c \
		residual.c \
		zero_wavefield.c \
		gradients.c \
		gradient_F.c \
		conjugategrad.c \
		hess_F.c \
		readhess.c \
		modelupdate.c \
		zero_invers.c \
		zero_grad.c \
		precongrad.c \
		hess_apply.c \
		outgrad.c \
		outmod.c \
		steplength.c \
		cpmodel.c \
		readinv.c \
		disc_fourier.c \
		exchange_Fv.c \
		model_gauss.c \
		filt_seis.c \
		model2_5D.c \
		smooth.c \
		lbfgs.c \
		lbfgs_save.c \
		constant_boundary.c \
		$(MODEL_SCR) \
		$(FDMPI_UTIL) 

FDMPI_SRC_RSG = \
		fdmpi_rsg.c \
		checkfd_rsg.c \
		seismo_rsg.c \
		update_s_rsg.c \
		matcopy.c \
		update_v_rsg.c \
		snap_rsg.c \
		exchange_v_rsg.c \
		exchange_s_rsg.c \
		psource_rsg.c \
		$(MODEL_SCR) \
		$(FDMPI_UTIL) 

FDMPI_ACOUSTIC_SRC = \
		av_mat_acoustic.c \
		fdmpi_acoustic.c \
		checkfd_acoustic.c \
		comm_ini_acoustic.c \
		seismo_ssg_acoustic.c \
		matcopy_acoustic.c \
		surface_acoustic.c \
		PML_ini_acoustic.c \
		absorb_PML.c \
		update_s_acoustic.c \
		update_v_acoustic.c \
		update_s_acoustic_PML.c \
		update_v_acoustic_PML.c \
		snap_ssg_acoustic.c \
		exchange_v_acoustic.c \
		exchange_s_acoustic.c \
		psource_acoustic.c \
		readmod_acoustic.c \
		$(MODEL_SCR_A) \
		$(FDMPI_UTIL) 

FDMPI_OBJ = $(FDMPI_SRC:%.c=%.o)
FDMPI_OBJ_RSG = $(FDMPI_SRC_RSG:%.c=%.o)
FDMPI_ACOUSTIC_OBJ = $(FDMPI_ACOUSTIC_SRC:%.c=%.o)
SNAPMERGE_OBJ = $(SNAPMERGE_SCR:%.c=%.o)
PARTMODEL_OBJ = $(PARTMODEL_SCR:%.c=%.o)
SEISMERGE_OBJ = $(SEISMERGE_SCR:%.c=%.o)

seismerge:	$(SEISMERGE_OBJ)
	$(CC) $(LFLAGS) $(SEISMERGE_OBJ) -o ../bin/seismerge	

snapmerge:	$(SNAPMERGE_OBJ)
	$(CC) $(LFLAGS) $(SNAPMERGE_OBJ) -o ../bin/snapmerge
		
part_model:	$(PARTMODEL_OBJ)
	$(CC) $(LFLAGS) $(PARTMODEL_OBJ) -o ../bin/partmodel

fdmpi: $(FDMPI_OBJ)
	$(CC)   $(SFLAGS) $(FDMPI_OBJ) $(LFLAGS) -o ../bin/fdmpi

fdmpi_acoustic: $(FDMPI_ACOUSTIC_OBJ)
	$(CC) $(LFLAGS)  $(FDMPI_ACOUSTIC_OBJ) -o ../bin/fdmpi_acoustic


clean:
	find . -name "*.o" -exec rm {} \;
	find . -name "*.bck" -exec rm {} \;
	find . -name "core" -exec rm {} \;

